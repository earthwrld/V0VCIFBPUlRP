---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="[505]">
  <main class="flex-1 flex flex-col items-center justify-center text-left p-4">
    <div class="w-full max-w-2xl font-mono text-green-700 dark:text-green-400 text-sm md:text-base bg-white/50 dark:bg-black/50 p-6 rounded-lg border border-gray-300 dark:border-green-700/50">
      <p>> Booting secret module...</p>
      <p>> Establishing secure connection...</p>
      <p>> Connection established.</p>
      <p class="text-yellow-600 dark:text-yellow-400">> Bypassing main security layer...</p>
      <p class="text-yellow-600 dark:text-yellow-400">> Accessing restricted area [505]...</p>
      <p class="text-green-600 dark:text-green-400">> Access Granted.</p>
      
      <div id="spotify-player-container" class="mt-6 w-full">
          <iframe 
              style="border-radius:12px" 
              src="https://open.spotify.com/embed/track/0BxE4FqsDD1Ot4YuBXwAPp?utm_source=generator&theme=0" 
              width="100%" 
              height="152" 
              frameBorder="0" 
              allowfullscreen="" 
              allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
              loading="lazy">
          </iframe>
      </div>

      <br>
      <p>> Loading secret message:</p>
      <p id="secret-message" class="mt-2 whitespace-pre-wrap"></p>
      <span id="cursor" class="animate-blink">â–ˆ</span>
    </div>
  </main>
</BaseLayout>

<script>
  function runSequence() {
    const messageElement = document.getElementById('secret-message');
    const cursor = document.getElementById('cursor');

    if (!messageElement || !cursor) return;
    
    const secretText = "I'm going back to 505...\nHehehe, you found the secret page! There's nothing special here, but your curiosity is a great asset for a cybersecurity enthusiast. Keep exploring!\n\n- Bumi";
    let i = 0;

    messageElement.innerHTML = ''; 

    function typeWriter() {
      if (i < secretText.length) {
        messageElement!.innerHTML += secretText.charAt(i);
        i++;
        setTimeout(typeWriter, 50);
      } else {
        cursor!.style.display = 'inline-block';
      }
    }
    
    // FIX: Logika untuk memunculkan player dihapus karena player sudah langsung terlihat
    cursor.style.display = 'none';
    setTimeout(typeWriter, 500);
  }

  runSequence();
  document.addEventListener('astro:after-swap', runSequence);
</script>